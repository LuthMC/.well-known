<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="NoxStore" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/fa62c117c7.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="styles.css" />
    <title>NoxStore | Digital Store</title>
  </head>
  <body class="light" id="top">
    <header class="header center">
      <h3>
        <a href="https://dsc.gg/noxstoredc" class="link"
          >NS.</a
        >
      </h3>

      <nav class="nav center">
        <ul class="nav__list center">
          <li class="nav__list-item">
            <a class="link link--nav" href="https://noxstore.cloud">Home</a>
          </li>
          <li class="nav__list-item">
            <a class="link link--nav" href="#discord">Discord</a>
          </li>
        </ul>

        <button type="button" aria-label="toggle theme" class="btn btn--icon">
          <i aria-hidden="true" id="btn-theme" class="fas fa-moon"></i>
        </button>

        <button
          type="button"
          aria-label="toggle navigation"
          class="btn btn--icon nav__hamburger"
        >
          <i aria-hidden="true" class="fas fa-bars"></i>
        </button>
      </nav>
    </header>

    <main>
      <!-- Contact -->
      <section class="section contact center" id="Discord">
        <h2 class="section__title">Donasi</h2>
          <script type='text/javascript' src='https://assets.trakteer.id/js/trbtn-overlay.min.js'></script>
          <script type='text/javascript' class='troverlay'>
            (function() {
              var trbtnId = trbtnOverlay.init('Donasi','#be1e2d','https://trakteer.id/noxstore/tip/embed/modal','https://cdn.trakteer.id/images/embed/trbtn-icon.png?date=18-11-2023','40','inline');
              trbtnOverlay.draw(trbtnId);

              // Handle the donation button click event
              document.querySelector('.troverlay').addEventListener('click', function() {
                fetchSupportHistory();
              });
            })();

            async function fetchSupportHistory() {
                const apiKey = 'trapi-6pImljsvfHInkuaU9HL8VGT';
                const url = 'https://api.trakteer.id/v1/public/supports';

                try {
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }

                    const data = await response.json();
                    const supports = data.data;

                    // Display the donation message for the latest support
                    if (supports.length > 0) {
                        const latestSupport = supports[0];
                        displayDonationMessage(latestSupport.name, latestSupport.quantity);
                    }

                    // Display the leaderboard
                    displayLeaderboard(supports);
                } catch (error) {
                    console.error('Error fetching support history:', error);
                }
            }

            function displayDonationMessage(name, amount) {
                const message = `${name} Telah Memberikan ${amount} Burung!`;
                const donationMessageDiv = document.getElementById('donation-message');
                donationMessageDiv.innerText = message;
                donationMessageDiv.style.display = 'block';
            }

            function displayLeaderboard(supports) {
                const leaderboardContent = document.getElementById('leaderboard-content');
                leaderboardContent.innerHTML = ''; // Clear previous content

                supports.forEach((support, index) => {
                    const leaderboardItem = document.createElement('div');
                    leaderboardItem.className = 'leaderboard-item';

                    const icon = document.createElement('i');
                    icon.className = 'fas fa-star'; // You can change the icon class here
                    leaderboardItem.appendChild(icon);

                    const text = document.createElement('span');
                    text.innerText = `${index + 1}. ${support.name} - ${support.quantity} Burung`;
                    leaderboardItem.appendChild(text);

                    leaderboardContent.appendChild(leaderboardItem);
                });
            }

            // Fetch the support history when the page loads
            document.addEventListener('DOMContentLoaded', fetchSupportHistory);
          </script>
          <div id="donation-message" style="display: none; text-align: center; margin-top: 20px;"></div>
      </section>

      <!-- Leaderboard -->
      <section class="section leaderboard center" id="leaderboard">
        <h2 class="section__title">Leaderboard</h2>
        <div id="leaderboard-content" class="leaderboard-content"></div>
      </section>
    </main>

    <footer class="footer">
      <a
        href="https://noxstore.cloud"
        class="link footer__link"
      >
        Â© NoxStore
      </a>
    </footer>

    <div class="scroll-container">
    <div class="scroll-top">
      <a aria-label="Scroll up" href="#top">
        <i aria-hidden="true" class="fas fa-arrow-up"></i>
      </a>
    </div>
    </div>

    <script src="./script.js"></script>
  </body>
</html>
